{"remainingRequest":"/Users/chrismoores/Projects/Vega/0x955C6789A7fbee203B4bE0F01428E769308813f2/node_modules/thread-loader/dist/cjs.js!/Users/chrismoores/Projects/Vega/0x955C6789A7fbee203B4bE0F01428E769308813f2/node_modules/babel-loader/lib/index.js!/Users/chrismoores/Projects/Vega/0x955C6789A7fbee203B4bE0F01428E769308813f2/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/chrismoores/Projects/Vega/0x955C6789A7fbee203B4bE0F01428E769308813f2/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/chrismoores/Projects/Vega/0x955C6789A7fbee203B4bE0F01428E769308813f2/src/components/ActiveOrdersMobile/ActiveOrders.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/chrismoores/Projects/Vega/0x955C6789A7fbee203B4bE0F01428E769308813f2/src/components/ActiveOrdersMobile/ActiveOrders.vue","mtime":1595618551645},{"path":"/Users/chrismoores/Projects/Vega/0x955C6789A7fbee203B4bE0F01428E769308813f2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/chrismoores/Projects/Vega/0x955C6789A7fbee203B4bE0F01428E769308813f2/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/chrismoores/Projects/Vega/0x955C6789A7fbee203B4bE0F01428E769308813f2/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/chrismoores/Projects/Vega/0x955C6789A7fbee203B4bE0F01428E769308813f2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/chrismoores/Projects/Vega/0x955C6789A7fbee203B4bE0F01428E769308813f2/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\nimport { dateToDisplayDateTime } from '@/utils/utility';\nimport VegaProtocolService from '@/services/VegaProtocolService';\nimport EventBus, { EventNames } from '@/eventBuses/default';\nimport { VegaKeys } from '@/utils/localStorage';\nimport gql from 'graphql-tag';\nexport default {\n  name: 'active-trades-mobile',\n  components: {},\n  props: {\n    open: {\n      type: Boolean\n    }\n  },\n\n  data() {\n    return {\n      orders: this.$store.getters.activeOrders,\n      tableHeight: '',\n      orders_array: [],\n      isLoggedIn: false,\n      partiesId: VegaKeys.currentActiveKey // showLoader:false,\n      // snapTaken: false,\n\n    };\n  },\n\n  apollo: {\n    $subscribe: {\n      orders: {\n        query: gql`subscription name($partyId: String!) {\n                  orders (partyId:$partyId) {\n                      id\n                      price\n                      side\n                      size\n                      remaining\n                      timeInForce\n                      market {\n                        id\n                        name\n                      }\n                      status\n                      createdAt\n                  }\n                }`,\n\n        variables() {\n          return {\n            partyId: this.partiesId\n          };\n        },\n\n        result({\n          data,\n          loading\n        }) {\n          if (loading) {// console.log('loading');\n          }\n\n          let order = data.orders; // console.log(order);\n\n          for (let i = 0; i < order.length; i++) {\n            // console.log(order[i]);\n            if (order[i] == null) {\n              this.$showErrorMsg({\n                message: ' Recently entered order has been rejected by the Vega Network'\n              });\n            } else if (order[i].status == 'Rejected') {\n              let msg = order[i].side + ' order for the market ' + order[i].market.name + ' of size = ' + order[i].size;\n              this.$showErrorMsg({\n                message: msg + ' has been rejected by the Vega Network'\n              });\n            } else if (order[i].status == 'Filled') {\n              let msg = order[i].side + ' order for the market ' + order[i].market.name + ' of size = ' + order[i].size;\n              this.$showSuccessMsg({\n                message: msg + ' has been filled'\n              });\n            } else if (order[i].status == 'Stopped') {\n              let msg = order[i].side + ' order for the market ' + order[i].market.name + ' of size = ' + order[i].size;\n              this.$showErrorMsg({\n                message: msg + ' has been stopped by the Vega Network'\n              });\n            } else if (order[i].status == 'PartiallyFilled') {\n              let msg = order[i].side + ' order for the market ' + order[i].market.name + ' of size = ' + order[i].size + ' has been partially filled (Filled = ' + (Number(order[i].size) - Number(order[i].remaining)) + ', Remaining = ' + Number(order[i].remaining);\n              this.$showSuccessMsg({\n                message: msg + ' by the Vega Network'\n              });\n              this.addNewOrder(order[i]);\n            } else if (order[i].status == 'Cancelled') {\n              this.$store.commit('removeFromActiveOrders', order[i].id);\n              let msg = order[i].side + ' order for the market ' + order[i].market.name + ' of size = ' + order[i].size + ' with orderID - ' + order[i].id;\n              this.$showSuccessMsg({\n                message: msg + ' has been successfully cancelled'\n              });\n            } else if (order[i].status == 'Active') {\n              //Only active Orders\n              this.addNewOrder(order[i]);\n            }\n          }\n        }\n\n      }\n    }\n  },\n\n  // computed: {\n  //   activeOrders() {\n  //     return this.mapActiveOrders(this.$store.getters.activeOrders);\n  //   },\n  // },\n  mounted() {\n    //handles Login/Logout\n    this.userLoginListener = () => this.getActiveOrders();\n\n    this.userLogoutListener = () => this.deleteOrders();\n\n    EventBus.$on(EventNames.userLogin, this.userLoginListener);\n    EventBus.$on(EventNames.userLogout, this.userLogoutListener);\n    EventBus.$on(EventNames.pubKeyChanged, this.userLoginListener); //to handle change in pubKey\n  },\n\n  methods: {\n    addNewOrder(order) {\n      //Adding new order incoming from subscription\n      let new_order = this.mapNewOrder(order); // console.log(new_order);\n      // this.orders.unshift(new_order);\n\n      this.$store.commit('addToActiveOrders', new_order); // console.log(this.$store.getters.activeOrders);\n    },\n\n    async getActiveOrders() {\n      //will call vegaProtocolService \n      this.$store.commit('activeOrders', []);\n      this.orders = [];\n      this.partiesId = VegaKeys.currentActiveKey; // console.log(this.partiesId);\n      // console.log(VegaKeys.currentActiveKey);\n\n      const response = await VegaProtocolService.get_orders_by_party(this.partiesId); // console.log(response);\n\n      if (response.status == 200) {\n        // console.log(response.data);\n        for (let i = 0; i < response.data.orders.length; i++) {\n          let new_ = this.mapNewOrder_API(response.data.orders[i]); // console.log(new_);\n          // this.orders.unshift(new_);\n\n          this.$store.commit('addToActiveOrders', new_); // console.log(this.$store.getters.activeOrders);\n        } // console.log(this.orders);\n\n\n        this.orders = this.$store.getters.activeOrders; // console.log(this.orders);          \n      } else {\n        this.$showErrorMsg({\n          message: 'Something went wrong. Couldn\\'t fetch orders'\n        });\n      }\n    },\n\n    deleteOrders() {\n      //cleaning order history \n      this.$store.commit('activeOrders', []);\n      this.orders = [];\n    },\n\n    mapNewOrder_API(order) {\n      let new_order = {};\n      new_order.id = order.id;\n      new_order.price = order.price;\n      new_order.side = order.side;\n      new_order.size = order.size;\n      new_order.remaining = order.remaining;\n      new_order.marketID = order.marketID;\n      new_order.market = this.getNameforMarketID(order.marketID);\n      new_order.status = order.status;\n      new_order.orderExecType = order.timeInForce;\n      new_order.creationTime = order.createdAt; // console.log(new_order);\n\n      return new_order;\n    },\n\n    getNameforMarketID(marketID) {\n      //Gets market name for market ID\n      let markets = this.$store.getters.mappedMarkets; // console.log(markets);\n\n      if (this.$store.getters.mappedMarkets.has(marketID)) {\n        // console.log(marketID + ' name found');\n        let data = this.$store.getters.mappedMarkets.get(marketID); // console.log(data);\n\n        return data.name;\n      } else {\n        return 'undefined';\n      }\n    },\n\n    mapNewOrder(order) {\n      let new_order = {};\n      new_order.id = order.id;\n      new_order.price = order.price;\n      new_order.side = order.side;\n      new_order.size = order.size;\n      new_order.remaining = order.remaining;\n      new_order.market = order.market.name;\n      new_order.marketID = order.market.id;\n      new_order.status = order.status;\n      new_order.orderExecType = order.timeInForce;\n      new_order.creationTime = order.createdAt;\n      return new_order;\n    },\n\n    toggleOpen() {\n      this.$emit('toggle-open');\n    },\n\n    formatDateTime(timestamp) {\n      return dateToDisplayDateTime(new Date(timestamp));\n    },\n\n    async cancelAllOrders() {\n      for (let i = 0; i < this.orders.length; i++) {\n        let resp = await this.cancelOrder(this.orders[i]);\n      } // console.log(this.orders);\n\n\n      this.getActiveOrders();\n    },\n\n    async cancelOrder(order) {\n      // console.log(order);\n      this.$store.commit('addLoaderTask', 1, false); // console.log('in cancel order');\n\n      try {\n        const data = await this.$apollo.mutate({\n          mutation: gql`mutation prepareOrderCancel($id: ID!, $partyId: String!, $marketId: String!) {\n            prepareOrderCancel(id:$id, partyId:$partyId,marketId:$marketId) {\n              blob\n            }\n          }`,\n          variables: {\n            id: order.id,\n            partyId: this.partiesId,\n            marketId: order.marketID\n          }\n        }); // console.log(data);\n        // console.log(data.data);\n        // console.log(data.data.prepareOrderCancel.blob);\n        // console.log('Cancel Order preparation successful for order with orderID ' + order.id );\n\n        let blob = data.data.prepareOrderCancel.blob;\n\n        try {\n          //SIGNING PREPARED ORDER\n          // console.log(blob);\n          const transactionSign = await VegaProtocolService.signtx(blob, true); //Propogating the transaction\n          // console.log(transactionSign);\n\n          if (transactionSign.status == 200) {\n            //IF SUCCESSFUL\n            let msg = 'Order Cancellation request for orderID: ' + order.id + ' has been successfully signed and propogated into the chain.'; // console.log(msg);    \n\n            this.$showSuccessMsg({\n              message: msg\n            });\n          } else {\n            //Else for signing order\n            let msg = 'Deletion request\\'s signature transaction failed. Please try again'; // console.log(msg);\n\n            this.$$showErrorMsg({\n              message: msg\n            });\n          }\n        } catch (err) {\n          //catch for signing order\n          let msg = ' Order signature for deletion request returned error. Please try again'; // console.log(msg);\n\n          this.$$showErrorMsg({\n            message: msg\n          });\n        }\n      } catch (error) {\n        // console.log(error);\n        let msg = ' Order deletion request preparation returned error. Please try again'; // console.log(msg);\n\n        this.$$showErrorMsg({\n          message: msg\n        });\n      }\n    }\n\n  },\n\n  destroyed() {\n    EventBus.$off(EventNames.userLogin, this.userLoginListener);\n    EventBus.$off(EventNames.userLogout, this.userLogoutListener);\n    EventBus.$off(EventNames.pubKeyChanged, this.userLoginListener); //to handle change in pubKey    \n  }\n\n};",{"version":3,"sources":["ActiveOrders.vue"],"names":[],"mappings":"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","sourcesContent":["<template src=\"./template.html\"></template>\n\n<script>\nimport { dateToDisplayDateTime, } from '@/utils/utility';\nimport VegaProtocolService from '@/services/VegaProtocolService';\nimport EventBus, { EventNames, } from '@/eventBuses/default';\nimport { VegaKeys, } from '@/utils/localStorage';\nimport gql from 'graphql-tag';\n\nexport default {\n  \n  name: 'active-trades-mobile',\n\n  components: {},\n\n  props: {\n    open: {\n      type: Boolean,\n    },\n  },\n\n  data() {\n    return {\n      orders: this.$store.getters.activeOrders,\n      tableHeight: '',\n      orders_array: [],\n      isLoggedIn: false,\n      partiesId: VegaKeys.currentActiveKey,          \n      // showLoader:false,\n      // snapTaken: false,\n    };\n  },  \n\n  apollo: {\n    $subscribe: {\n      orders: {\n        query: gql`subscription name($partyId: String!) {\n                  orders (partyId:$partyId) {\n                      id\n                      price\n                      side\n                      size\n                      remaining\n                      timeInForce\n                      market {\n                        id\n                        name\n                      }\n                      status\n                      createdAt\n                  }\n                }`,\n\n        variables() {  return {partyId: this.partiesId,};  },\n\n        result({data,loading,}) {\n          if (loading) {\n            // console.log('loading');\n          }\n          let order = data.orders;\n          // console.log(order);\n          for (let i=0;i<order.length;i++)\n          {\n            // console.log(order[i]);\n            if (order[i] == null ) {\n              this.$showErrorMsg({message: ' Recently entered order has been rejected by the Vega Network',});                \n            }\n            else if ( order[i].status == 'Rejected') {\n              let msg = order[i].side + ' order for the market ' + order[i].market.name + ' of size = ' + order[i].size;\n              this.$showErrorMsg({message: msg +  ' has been rejected by the Vega Network',});                \n            }\n            else if (order[i].status == 'Filled') {\n              let msg = order[i].side + ' order for the market ' + order[i].market.name + ' of size = ' + order[i].size;\n              this.$showSuccessMsg({message: msg +  ' has been filled',});                \n            }\n            else if (order[i].status == 'Stopped') {\n              let msg = order[i].side + ' order for the market ' + order[i].market.name + ' of size = ' + order[i].size;\n              this.$showErrorMsg({message: msg +  ' has been stopped by the Vega Network',});                \n            }\n            else if (order[i].status == 'PartiallyFilled') {\n              let msg = order[i].side + ' order for the market ' + order[i].market.name + ' of size = ' + order[i].size + ' has been partially filled (Filled = ' + (Number(order[i].size) - Number(order[i].remaining)) + ', Remaining = ' + Number(order[i].remaining);\n              this.$showSuccessMsg({message: msg +  ' by the Vega Network',});                \n              this.addNewOrder(order[i]);\n\n            }\n            else if (order[i].status == 'Cancelled') {\n              this.$store.commit('removeFromActiveOrders',order[i].id);\n              let msg = order[i].side + ' order for the market ' + order[i].market.name + ' of size = ' + order[i].size + ' with orderID - ' + order[i].id;\n              this.$showSuccessMsg({message: msg +  ' has been successfully cancelled',});                \n            }           \n            else if (order[i].status == 'Active') {  //Only active Orders\n              this.addNewOrder(order[i]);\n            }\n          }\n        },\n      },\n    },\n  },\n\n\n  // computed: {\n  //   activeOrders() {\n  //     return this.mapActiveOrders(this.$store.getters.activeOrders);\n  //   },\n  // },\n\n  mounted() {     //handles Login/Logout\n    this.userLoginListener = () => this.getActiveOrders();\n    this.userLogoutListener = () => (this.deleteOrders());\n    EventBus.$on(EventNames.userLogin, this.userLoginListener);\n    EventBus.$on(EventNames.userLogout, this.userLogoutListener);\n    EventBus.$on(EventNames.pubKeyChanged,this.userLoginListener);  //to handle change in pubKey\n  },\n\n  methods: {\n\n    addNewOrder(order) {  //Adding new order incoming from subscription\n      let new_order = this.mapNewOrder(order);\n      // console.log(new_order);\n      // this.orders.unshift(new_order);\n      this.$store.commit('addToActiveOrders',new_order);\n      // console.log(this.$store.getters.activeOrders);\n    },\n\n    async getActiveOrders() {     //will call vegaProtocolService \n      this.$store.commit('activeOrders',[]);\n      this.orders = [];\n      this.partiesId = VegaKeys.currentActiveKey;\n      // console.log(this.partiesId);\n      // console.log(VegaKeys.currentActiveKey);\n      const response = await VegaProtocolService.get_orders_by_party(this.partiesId);\n      // console.log(response);\n      if (response.status == 200) {\n        // console.log(response.data);\n        for (let i=0; i<response.data.orders.length;i++) {\n          let new_ = this.mapNewOrder_API(response.data.orders[i]);\n          // console.log(new_);\n          // this.orders.unshift(new_);\n          this.$store.commit('addToActiveOrders',new_);\n          // console.log(this.$store.getters.activeOrders);\n        }\n          // console.log(this.orders);\n          this.orders = this.$store.getters.activeOrders;\n          // console.log(this.orders);          \n      }\n      else {\n        this.$showErrorMsg({message: 'Something went wrong. Couldn\\'t fetch orders',});        \n      }\n    },\n\n    deleteOrders() {  //cleaning order history \n      this.$store.commit('activeOrders',[]);\n      this.orders = [];\n    },\n\n    mapNewOrder_API(order) {\n      let new_order = {};\n      new_order.id = order.id;\n      new_order.price = order.price;\n      new_order.side = order.side;\n      new_order.size = order.size;\n      new_order.remaining = order.remaining;\n      new_order.marketID = order.marketID;\n      new_order.market = this.getNameforMarketID(order.marketID);\n      new_order.status = order.status;\n      new_order.orderExecType = order.timeInForce;\n      new_order.creationTime = order.createdAt;\n      // console.log(new_order);\n      return new_order;\n    },    \n\n    getNameforMarketID(marketID) {          //Gets market name for market ID\n      let markets = this.$store.getters.mappedMarkets;\n      // console.log(markets);\n      if (this.$store.getters.mappedMarkets.has(marketID)) {\n        // console.log(marketID + ' name found');\n        let data = this.$store.getters.mappedMarkets.get(marketID);\n        // console.log(data);\n        return data.name;\n      }\n      else {\n        return 'undefined';\n      }\n    },\n\n    mapNewOrder(order) {\n      let new_order = {};\n      new_order.id = order.id;\n      new_order.price = order.price;\n      new_order.side = order.side;\n      new_order.size = order.size;\n      new_order.remaining = order.remaining;\n      new_order.market = order.market.name;\n      new_order.marketID = order.market.id;\n      new_order.status = order.status;\n      new_order.orderExecType = order.timeInForce;\n      new_order.creationTime = order.createdAt;\n      return new_order;\n    },\n\n    toggleOpen() {\n      this.$emit('toggle-open');\n    },\n\n    formatDateTime(timestamp) {\n      return dateToDisplayDateTime(new Date(timestamp));\n    },\n\n    async cancelAllOrders() {\n      for (let i=0;i<this.orders.length;i++) {\n        let resp = await this.cancelOrder(this.orders[i]);\n      }\n      // console.log(this.orders);\n      this.getActiveOrders();\n    },\n\n    async cancelOrder(order) {        \n      // console.log(order);\n      this.$store.commit('addLoaderTask', 1, false);\n      // console.log('in cancel order');\n      try {\n        const data = await this.$apollo.mutate({\n            mutation: gql`mutation prepareOrderCancel($id: ID!, $partyId: String!, $marketId: String!) {\n            prepareOrderCancel(id:$id, partyId:$partyId,marketId:$marketId) {\n              blob\n            }\n          }`,\n          variables: { id:order.id, partyId:this.partiesId, marketId: order.marketID },\n        });\n      \n        // console.log(data);\n        // console.log(data.data);\n        // console.log(data.data.prepareOrderCancel.blob);\n        // console.log('Cancel Order preparation successful for order with orderID ' + order.id );\n        let blob = data.data.prepareOrderCancel.blob;\n\n        try{                      //SIGNING PREPARED ORDER\n            // console.log(blob);\n            const transactionSign = await VegaProtocolService.signtx(blob,true);  //Propogating the transaction\n            // console.log(transactionSign);\n            if (transactionSign.status == 200) {    //IF SUCCESSFUL\n              let msg = 'Order Cancellation request for orderID: ' + order.id + ' has been successfully signed and propogated into the chain.';\n              // console.log(msg);    \n              this.$showSuccessMsg({message: msg,});                \n            }\n            else {      //Else for signing order\n              let msg = 'Deletion request\\'s signature transaction failed. Please try again';\n              // console.log(msg);\n              this.$$showErrorMsg({message: msg});                \n           }\n        }\n        catch (err) {  //catch for signing order\n          let msg = ' Order signature for deletion request returned error. Please try again';\n          // console.log(msg);\n          this.$$showErrorMsg({message: msg});                \n        }\n      }\n      catch(error) {\n        // console.log(error);\n        let msg = ' Order deletion request preparation returned error. Please try again';\n        // console.log(msg);\n        this.$$showErrorMsg({message: msg});                        \n      } \n    }\n  },\n\n  destroyed() {\n    EventBus.$off(EventNames.userLogin, this.userLoginListener);\n    EventBus.$off(EventNames.userLogout, this.userLogoutListener);\n    EventBus.$off(EventNames.pubKeyChanged,this.userLoginListener);  //to handle change in pubKey    \n  },\n\n};\n</script>\n\n<style lang=\"scss\" src=\"./style.scss\" scoped></style>\n\n\n"],"sourceRoot":"src/components/ActiveOrdersMobile"}]}